<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Horizon watch() tester</title>
  </head>
  <body>

    <div id="squares">

    </div>
    <script src="/bower_components/underscore/underscore-min.js" type="text/javascript"></script>
    <script src="/bower_components/randomcolor/randomColor.js" type="text/javascript"></script>
    <script src="/horizon/horizon.js" type="text/javascript"></script>
    <script type="text/javascript">

      const E = 100
      const squaresDiv = document.querySelector("#squares");
      const addElement = () => {
        const e = document.createElement('div');
        e.style['background-color'] = randomColor();
        e.style['height'] = (window.innerHeight / E) + 'px';
        e.style['width'] = (window.innerWidth / E) + 'px';
        e.style['float'] = 'left';
        squaresDiv.appendChild(e)
        return e;
      }

      const table_names = _.range(1,E + 1).map((n) => {return `table_${n}`});
      const horizon = Horizon();
      horizon.connect();
      const collections = new Map();
      table_names.map((name) => {
        collections.set(name, horizon(name));
        const e = addElement();
        horizon(name).find(1).watch().subscribe((doc) => {
          e.style['background-color'] = doc['color'];
        });
      });

      let newColors = () => {
        for (var [name, collection] of collections.entries()) {
          collection.upsert({
            id: 1,
            color: randomColor()
          });
        };
      }

      setInterval(newColors, 1000);
    </script>
  </body>
</html>
